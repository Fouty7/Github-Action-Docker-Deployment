---
- name: configuration play 
  hosts: web
  user: ubuntu
  become: true
  become_method: sudo
  gather_facts: false
  tasks:

  - name: copy/update files
    become: yes
    shell: |
      git clone https://github.com/Fouty7/github-action.git
      cd github-action
      git pull
    
 
  - name: start docker compose
    become: yes
    shell: |
      cd github-action
      docker image ls
      docker compose up -d --build
      
# Uncomment the last play (cleanup old images) in the shell comand below to clean up dangling docker images. Leave as it is if this is your first run of the pipeline or if no changes have been made to your application code!!
  #- name: cleanup old images
  #  become: yes
  #  shell: docker rmi $(docker images --filter "dangling=true" -q --no-trunc)